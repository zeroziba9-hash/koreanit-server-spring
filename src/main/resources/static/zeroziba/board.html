<!doctype html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>zeroziba board</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"><link rel="stylesheet" href="/zeroziba/assets/styles.css"></head><body><div class="wrap"><header class="topbar"><nav class="nav row"><a href="/zeroziba/index.html">홈</a><a href="/zeroziba/auth.html">인증</a><a class="active" href="/zeroziba/board.html">게시판</a></nav><div class="row"><button id="btnRefresh" class="btn">새로고침</button><button id="btnLogout" class="btn">로그아웃</button></div></header>
<section class="panel hero"><div class="title">PROJECT SHOWCASE</div><h2>게시글 · 댓글 · 권한을<br>실무형 UX로 검증하는 공간</h2><p>목록 조회/작성/삭제, 관리자 일괄삭제, 상세 페이지 이동까지 하나의 흐름으로 테스트할 수 있어.</p></section>
<section class="panel"><div id="topError" class="alert err" style="display:none"><div><b>에러:</b> <span id="topErrorMsg"></span> <span id="topErrorAt" class="muted"></span></div><button class="btn" id="btnClearErr">닫기</button></div><div id="topInfo" class="alert info" style="display:none"><div><b>안내:</b> <span id="topInfoMsg"></span> <span id="topInfoAt" class="muted"></span></div><button class="btn" id="btnClearInfo">확인</button></div><div class="title" style="margin-top:10px">상단 로그</div><pre id="topLog" class="log"></pre></section>
<section class="panel" id="adminBatchPanel" style="display:none"><div class="row between"><div class="title" style="margin:0">관리자 일괄삭제</div><label class="row" style="font-size:13px"><input type="checkbox" id="adminDeleteToggle"> 삭제 모드</label></div><div class="row" style="margin-top:8px"><button class="btn" id="btnSelectAll">전체선택</button><button class="btn" id="btnClearSelection">선택해제</button><button class="btn btn-main" id="btnDeleteSelected">선택 삭제</button><span class="muted" id="selectedCount">0개 선택됨</span></div></section>
<section class="panel"><div class="title">게시글 목록</div><div class="board-head"><span class="w-16">선택</span><span class="w-16">번호</span><span class="grow">제목</span><span class="w-20 right">작성자</span><span class="w-16 right">댓글</span><span class="w-16 right">관리</span></div><div id="postList" class="list"></div></section>
<section class="grid g3"><section class="panel"><div class="title">글 작성</div><form id="fPost" class="form-row"><input class="input" name="title" placeholder="제목" required><textarea class="input" name="content" placeholder="내용" style="min-height:120px" required></textarea><button class="btn btn-main">등록</button></form></section><section class="panel"><div class="title">댓글</div><form id="fComment" class="form-row"><input class="input" name="postId" type="number" min="1" placeholder="postId" required><input class="input" name="content" placeholder="댓글 내용" required><button class="btn btn-main">댓글 등록</button></form><div class="muted" style="margin-top:8px">선택 글의 댓글은 글 상세 페이지에서 확인</div></section></section>
</div><script src="/zeroziba/assets/api.js"></script><script src="/zeroziba/assets/common.js"></script><script>
const {$,bindTopAlerts,toast}=ZCommon;bindTopAlerts();
const list=$('#postList');
const selectedIds=new Set();
let posts=[];
let isAdmin=false;
let adminDeleteMode=false;

function showListSkeleton(cnt=6){
  list.innerHTML='';
  for(let i=0;i<cnt;i++){const sk=document.createElement('div');sk.className='skeleton';list.appendChild(sk);}
}
function updateSelectedCount(){ $('#selectedCount').textContent=`${selectedIds.size}개 선택됨`; }

function render(){
  list.innerHTML='';
  posts.forEach(p=>{
    const row=document.createElement('div');
    row.className='board-row fade-up';
    row.innerHTML=`
      <span class="w-16"><input type="checkbox" data-check="${p.id}" ${selectedIds.has(p.id)?'checked':''} ${!(isAdmin&&adminDeleteMode)?'disabled':''}></span>
      <span class="w-16 muted">${p.id}</span>
      <span class="grow truncate">${p.title}</span>
      <span class="w-20 right muted">${p.userId}</span>
      <span class="w-16 right muted">${p.commentsCnt??0}</span>
      <span class="w-16 right"><button class="btn" data-del="${p.id}">삭제</button></span>`;

    row.onclick=(e)=>{ if(e.target.closest('[data-del]')||e.target.closest('[data-check]')) return; location.href=`/zeroziba/post.html?id=${p.id}`; };

    const chk=row.querySelector('[data-check]');
    chk.onchange=(e)=>{ const id=Number(e.target.dataset.check); if(e.target.checked) selectedIds.add(id); else selectedIds.delete(id); updateSelectedCount(); };

    row.querySelector('[data-del]').onclick=async(e)=>{
      e.stopPropagation();
      if(!confirm('이 글을 삭제할까요? (작성자/관리자만 가능)')) return;
      try{ await KApi.deletePost(p.id); toast('게시글 삭제 완료'); await load(); }
      catch(_){ }
    };

    list.appendChild(row);
  });
  if(posts.length===0){ list.innerHTML='<div class="muted" style="padding:10px">아직 게시글이 없어. 첫 글을 작성해봐!</div>'; }
  updateSelectedCount();
}

async function load(){
  showListSkeleton();
  try{ posts=await KApi.posts(); render(); }
  catch(_){ }
}

async function initAdmin(){
  try{
    const perm=await KApi.mePermissions();
    isAdmin=!!perm.admin;
    if(isAdmin) $('#adminBatchPanel').style.display='block';
  }catch(_){ isAdmin=false; }
}

$('#adminDeleteToggle').addEventListener('change',(e)=>{ adminDeleteMode=e.target.checked; render(); });
$('#btnSelectAll').addEventListener('click',()=>{ if(!(isAdmin&&adminDeleteMode)) return; posts.forEach(p=>selectedIds.add(p.id)); render(); });
$('#btnClearSelection').addEventListener('click',()=>{ selectedIds.clear(); render(); });
$('#btnDeleteSelected').addEventListener('click',async()=>{
  if(!(isAdmin&&adminDeleteMode)){ alert('관리자 삭제 모드를 켜줘'); return; }
  if(selectedIds.size===0){ alert('선택된 글이 없어'); return; }
  if(!confirm(`선택된 ${selectedIds.size}개 글을 삭제할까?`)) return;

  const ids=[...selectedIds];
  let ok=0, fail=0;
  for(const id of ids){
    try{ await KApi.deletePost(id); selectedIds.delete(id); ok++; }
    catch(_){ fail++; }
  }
  toast(`일괄삭제 완료: 성공 ${ok} / 실패 ${fail}`);
  KApi.push('일괄삭제 결과',{message:`성공 ${ok}건 / 실패 ${fail}건`});
  await load();
});

$('#btnRefresh').onclick=()=>{ toast('목록을 새로고침합니다'); load(); };
$('#btnLogout').onclick=async()=>{ try{ await KApi.logout(); toast('로그아웃 완료'); location.href='/zeroziba/auth.html'; }catch(_){} };
$('#fPost').addEventListener('submit',async e=>{ e.preventDefault(); const f=new FormData(e.target); try{ await KApi.createPost({title:f.get('title'),content:f.get('content')}); e.target.reset(); toast('게시글 등록 완료'); load(); }catch(_){} });
$('#fComment').addEventListener('submit',async e=>{ e.preventDefault(); const f=new FormData(e.target); try{ await KApi.createComment(Number(f.get('postId')),f.get('content')); e.target.reset(); toast('댓글 등록 완료'); }catch(_){} });

(async()=>{ await initAdmin(); await load(); })();
</script></body></html>